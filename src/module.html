<div class="trafficlight-panel" ng-style="{height: ctrl.height}" class="traffic-light-vis">
  <div class="traffic-light-vis" ng-repeat="line in ctrl.lines">
    <div ng-repeat="metric in line" class="traffic-light-box" ng-style="{'width':ctrl.percentPerLight+'%'}">
      <div class="traffic-light-container" ng-style="{'width': ctrl.panel.trafficLightSettings.width+'px', 'height': (2.68 * ctrl.panel.trafficLightSettings.width)+'px' }">
        <div class="traffic-light">
          <div class="light red" ng-class="{'on':
						(!ctrl.panel.trafficLightSettings.invertScale && ((metric.value <= ctrl.panel.trafficLightSettings.redThreshold) || (metric.value >= ctrl.panel.trafficLightSettings.max)))
						|| (ctrl.panel.trafficLightSettings.invertScale && metric.value >= ctrl.panel.trafficLightSettings.redThreshold) }">
          </div>
          <div class="light yellow" ng-class="{'on': (!ctrl.panel.trafficLightSettings.invertScale && metric.value > ctrl.panel.trafficLightSettings.redThreshold && metric.value < ctrl.panel.trafficLightSettings.greenThreshold) || (ctrl.panel.trafficLightSettings.invertScale && metric.value < ctrl.panel.trafficLightSettings.redThreshold && metric.value > ctrl.panel.trafficLightSettings.greenThreshold) }"></div>
          <div class="light green" ng-class="{'on':
					(!ctrl.panel.trafficLightSettings.invertScale && metric.value >= ctrl.panel.trafficLightSettings.greenThreshold && metric.value < ctrl.panel.trafficLightSettings.max)
					|| (ctrl.panel.trafficLightSettings.invertScale && metric.value <= ctrl.panel.trafficLightSettings.greenThreshold) }"></div>
        </div>
      </div>
      <div class="traffic-light-legend" style="font-size: {{ctrl.panel.trafficLightSettings.fontSize}};">{{metric.name}}
          <span ng-if="ctrl.panel.trafficLightSettings.showValue">
            <br/>({{metric.value | number:1}})</div>
          </span>
    </div>
  </div>
</div>
